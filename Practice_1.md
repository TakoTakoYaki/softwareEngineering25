# Отчёт по практической работе № 1
**Тема:** SRS проекта - Система учета расходов пользователей <br>
---
**Выполнили:** Бадмаев Николай P4150, Коряушкин Кирилл P4150 <br>


# 1. Введение (Introduction)

### 1.1 Область действия (Scope)

Разрабатываемая система предназначена для учета, хранения, анализа и управления личными и корпоративными расходами пользователей через веб-интерфейс и `REST API`.

Система предоставляет следующие основные возможности:
- регистрация и аутентификация пользователей через систему единого входа `Keycloak`;
- управление пользователями и их ролями;
- добавление, редактирование и удаление расходов;
- категоризация расходов;
- фильтрация и поиск расходов;
- формирование базовой статистики по расходам;
- разграничение доступа на основе ролей.

Система не предназначена для:
- проведения реальных финансовых операций и платежей;
- интеграции с банковскими системами;
- автоматического импорта транзакций;
- бухгалтерского учета по стандартам налоговой отчетности.

Цели системы:
- предоставить централизованный инструмент для учета расходов;
- повысить прозрачность финансовых данных;
- обеспечить безопасность доступа к данным;
- продемонстрировать архитектуру современного веб-приложения с использованием микросервисов аутентификации и серверной СУБД.

---

### 1.2 Определения, акронимы и сокращения (Definitions, Acronyms, Abbreviations)

| Термин         | Описание                                            |
| -------------- | --------------------------------------------------- |
| **API**        | Application Programming Interface                   |
| **REST**       | Representational State Transfer                     |
| **SRS**        | Software Requirements Specification                 |
| **ORM**        | Object-Relational Mapping                           |
| **JWT**        | JSON Web Token                                      |
| **RBAC**       | Role-Based Access Control                           |
| **IdP**        | Identity Provider                                   |
| **Keycloak**   | Система управления пользователями и аутентификацией |
| **PostgreSQL** | Реляционная серверная СУБД                          |
| **Expense**    | Запись о расходе                                    |
| **User**       | Пользователь системы                                |

---

### 1.3 Ссылки (References)

- [SRS Wiki](https://ru.wikipedia.org/wiki/Спецификация_требований_программного_обеспечения)
- [Документация FastAPI](https://fastapi.tiangolo.com/)
- [Документация PostgreSQL](https://www.postgresql.org/docs/) https://www.keycloak.org/documentation
- [Документация Keycloak](https://www.keycloak.org/documentation)

---

### 1.4 Обзор документа (Document Overview)

В данном документе описываются требования к системе учета расходов. <br><br>
Раздел 1 содержит общее введение и цели проекта.<br>
Раздел 2 описывает архитектурный контекст системы, основные функции, категории пользователей, среду эксплуатации, предположения и зависимости.

--- 
<br>

# 2. Общее описание (Overall Description)

### 2.1 Взаимодействие с продуктом (Product Perspective)

Система является самостоятельным веб-приложением, состоящим из следующих компонентов:

- Backend API (FastAPI);
- Сервис аутентификации и авторизации Keycloak;
- База данных PostgreSQL;
- Веб-интерфейс (HTML + CSS, Jinja2).

**Взаимодействие компонентов:**

- Пользователь обращается через браузер к веб-интерфейсу.
- Аутентификация происходит через Keycloak по протоколу OAuth2/OpenID Connect.
- После успешного входа пользователь получает `JWT-токен`.
- Backend API проверяет токен при каждом запросе.
- Данные хранятся и обрабатываются в `PostgreSQL`.
- Система может быть интегрирована с внешними сервисами через `REST API`.

---

### 2.2 Функции продукта (Product Functions)

Основные функции системы:

- Аутентификация пользователей через `Keycloak`;
- Управление пользователями и ролями (администратор, пользователь);
- Создание, редактирование, удаление расходов;
- Назначение категории и метода оплаты;
- Фильтрация расходов по дате, категории и пользователю;
- Просмотр статистики расходов;
- Управление пользователями (для администраторов);
- `REST API` для внешних клиентов.

---

### 2.3 Пользователи и характеристики (User Classes and Characteristics)

**Администратор**

- Полный доступ ко всем данным системы;
- Управление пользователями и ролями;
- Просмотр статистики всех пользователей;
- Требуется средний уровень технической подготовки.

---

**Обычный пользователь**

- Доступ только к собственным расходам;
- Просмотр и редактирование своих данных;
- Формирование личной статистики;
- Базовый уровень компьютерной грамотности.

---

**Сервисный клиент (API consumer)**

- Использует `REST API`;
- Авторизация через токен;
- Используется для интеграции с внешними системами.

---

### 2.4 Окружение и ограничения (Operating Environment)

**Серверная часть:**

- ОС: `Linux (Ubuntu Server)` или `Windows Server`;
- `Python 3.10+`;
- `FastAPI`;
- `PostgreSQL 13+`;
- `Keycloak 22+`;
- `Docker`.

**Клиентская часть:**

- Современные браузеры (Chrome, Firefox, Edge);
- Поддержка `JavaScript` и `cookies`.

**Ограничения:**

- Требуется стабильное интернет-соединение;
- Требуется доступ к `Keycloak` серверу;
- Производительность зависит от ресурсов сервера.


---

### 2.5 Предположения и зависимости (Assumptions and Dependencies)

**Предположения:**

- Пользователи имеют доступ к интернету;
- Пользователи обладают базовыми навыками работы с веб-приложениями;
- Сервер `Keycloak` доступен постоянно;
- `PostgreSQL` корректно настроен и резервируется.

**Зависимости:**

- Корректная работа `Keycloak`;
- Корректная конфигурация `OAuth2/OpenID Connect`;
- Доступность базы данных `PostgreSQL`;
- Поддержка `JWT` токенов клиентом.

---
<br>

# 3. Детальные требования (Specific Requirements)

### 3.1 Функциональные требования (Functional Requirements)

### Аутентификация и авторизация

**FR-1**  
Система должна поддерживать аутентификацию пользователей через внешний Identity Provider Keycloak по протоколу OpenID Connect.

**FR-2**  
Система должна выдавать пользователю `JWT-токен` после успешной аутентификации.

**FR-3**  
Система должна проверять валидность `JWT-токена` при каждом запросе к `API`.

**FR-4**  
Система должна поддерживать разграничение прав доступа на основе ролей (RBAC): *Administrator* и *User*.

---

### Управление пользователями

**FR-5**  
Администратор должен иметь возможность просматривать список всех пользователей системы.

**FR-6**  
Администратор должен иметь возможность изменять роли пользователей.

**FR-7**  
Система должна запрещать обычным пользователям доступ к данным других пользователей.

---

### Управление расходами

**FR-8**  
Пользователь должен иметь возможность создавать запись о расходе.

**FR-9**  
Пользователь должен иметь возможность редактировать собственные расходы.

**FR-10**  
Пользователь должен иметь возможность удалять собственные расходы.

**FR-11**  
Система должна запрещать пользователю изменять или удалять расходы других пользователей.

---

### Фильтрация и поиск

**FR-12**  
Система должна поддерживать фильтрацию расходов по дате.

**FR-13**  
Система должна поддерживать фильтрацию расходов по категории.

**FR-14**  
Система должна поддерживать фильтрацию расходов по пользователю (только для администратора).

---

### Статистика

**FR-15**  
Система должна предоставлять статистику расходов пользователя за выбранный период.

**FR-16**  
Администратор должен иметь возможность просматривать агрегированную статистику по всем пользователям.

---

### API

**FR-17**  
Система должна предоставлять REST API для всех основных операций.

**FR-18**  
API должно использовать формат JSON.

---
<br>

## 3.2 Нефункциональные требования (Non-Functional Requirements)

### 3.2.1 Производительность (Performance)

**NFR-P-1**  
Время ответа API на стандартные запросы не должно превышать 1 с при нагрузке до 50 одновременных пользователей.

**NFR-P-2**  
Главная страница должна загружаться не более чем за 2 секунды при 100 одновременных пользователей.

**NFR-P-3**  
Система должна поддерживать не менее 100 активных пользователей одновременно.

---

### 3.2.2 Надежность (Reliability)

**NFR-R-1**  
Доступность системы должна составлять не менее 99.5% в месяц.

**NFR-R-2**  
Система должна обеспечивать восстановление работоспособности после сбоя базы данных не более чем за 30 минут.

**NFR-R-3**  
Все операции записи в БД должны выполняться в транзакциях.

---

### 3.2.3 Безопасность (Security)

**NFR-S-1**  
Все пользователи должны проходить аутентификацию через Keycloak.

**NFR-S-2**  
Система должна использовать JWT для передачи информации об аутентификации.

**NFR-S-3**  
Передача данных должна осуществляться по HTTPS.

**NFR-S-4**  
Пароли пользователей не должны храниться в приложении и обрабатываются исключительно Keycloak.

**NFR-S-5**  
Система должна защищаться от SQL-инъекций за счет использования ORM.

**NFR-S-6**  
Должны быть реализованы проверки прав доступа для каждого защищенного API endpoint.

---

### 3.2.4 Удобство использования (Usability)

**NFR-U-1**  
Интерфейс должен соответствовать принципам минимализма и единообразия.

**NFR-U-2**  
Новый пользователь должен иметь возможность создать запись о расходе менее чем за 3 минуты без обучения.

**NFR-U-3**  
Система должна отображать сообщения об ошибках в понятной форме.

---

### 3.2.5 Сопровождаемость (Maintainability)

**NFR-M-1**  
Код должен быть модульным с разделением на слои (routers, services, models).

**NFR-M-2**  
Система должна поддерживать миграции базы данных через Alembic.

**NFR-M-3**  
Все основные компоненты должны быть покрыты логированием.

---

### 3.2.6 Портируемость (Portability)

**NFR-PR-1**  
Система должна корректно запускаться на Linux и Windows.

**NFR-PR-2**  
Система должна поддерживать развёртывание в Docker-контейнерах.

---
<br>

## 3.3 Требования к интерфейсам (Interface Requirements)

### 3.3.1 Пользовательский интерфейс (UI)

**UI-1**  
Веб-интерфейс должен поддерживать адаптивную верстку.

**UI-2**  
Интерфейс должен использовать единый стиль оформления.

**UI-3**  
Формы ввода должны содержать валидацию данных на стороне сервера.

---

### 3.3.2 Программные интерфейсы (API)

**API-1**  
API должно соответствовать принципам REST.

**API-2**  
Формат данных — JSON.

**API-3**  
API должно использовать OAuth2 Bearer Token.

**API-4**  
Основные endpoints:

- `POST /api/expenses`
- `GET /api/expenses`
- `PUT /api/expenses/{id}`
- `DELETE /api/expenses/{id}`
- `GET /api/stats`

---

### 3.3.3 Аппаратные интерфейсы (Hardware)

**HW-1**  
Система не использует специализированные аппаратные интерфейсы.

---

### 3.3.4 Интерфейсы связи (Communication)

**COM-1**  
Используется протокол HTTPS.

**COM-2**  
Для взаимодействия с Keycloak используется протокол OpenID Connect.

---
<br>

## 3.4 Требования к данным (Data Requirements)

### 3.4.1 Логическая модель данных

Основные сущности:

#### User
- id
- username
- email
- role

#### Expense
- id
- amount
- category
- description
- payment_method
- date
- user_id

---

### 3.4.2 Требования к хранению данных

**DATA-1**  
Данные должны храниться в PostgreSQL.

**DATA-2**  
Минимальный срок хранения данных — 3 года.

**DATA-3**  
Резервное копирование должно выполняться не реже одного раза в сутки.

**DATA-4**  
Архивирование старых данных старше 3 лет должно выполняться автоматически.

---

### 3.4.3 Требования к целостности данных

**DATA-INT-1**  
Сумма расхода должна быть неотрицательной.

**DATA-INT-2**  
Каждый расход должен быть связан с существующим пользователем.

**DATA-INT-3**  
Метод оплаты должен принадлежать допустимому множеству значений.

**DATA-INT-4**  
Удаление пользователя должно приводить к каскадному удалению его расходов.
